<% if logged_in? %>
  <% provide(:title, 'Sub Requests') %>
  <h1>Sub Requests</h1>
  <br>
  <div id="calendar"></div>
  <script type="text/javascript">
    $(function() {

      $('#calendar').each(function(){
        var calendar = $(this);
        calendar.fullCalendar({
        defaultView: 'month',

        header: {
          left: 'prev,next addEventButton',
          center: 'title',
          right: 'today month,agendaWeek,agendaDay'
        },

        customButtons: {
          addEventButton: {
            text: 'request a sub...',
            click: function() {
              var dateStr = prompt('Enter a date in YYYY-MM-DD format');
              var date = moment(dateStr);

              if (date.isValid()) {
                $('#calendar').fullCalendar('renderEvent', {
                  title: 'my sub request',
                  start: date,
                  allDay: true
                });
                $.ajax({
                  url: events.create,
                  data: {
                    title: 'my sub request',
                    start: date,
                    allDay: true
                  },
                  type: 'POST',
                });
              } else {
                alert('Invalid date.');
              }
            }
          }
        }
      });
    });
  });
  </script>

<% else %>
  <%= render 'static_pages/logged_out_home' %>
<% end %>
